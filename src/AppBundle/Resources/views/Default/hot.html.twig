{% extends 'AppBundle::layout.html.twig' %}

{% block content %}
    <div class="row">
        <div class="col-sm-4">
            <div class="box">
                <form method="GET" id="form">
                    <div class="form">
                        <div class="title" style="font-size: 20px">Поиск горящих предложений</div>
                        <br />
                        <select name="city">
                            <option value="0" disabled selected>Город</option>
                            <option value="0" selected>Все города</option>
                            <option value="Москва">Москва</option>
                            <option value="Подольск">Подольск</option>
                        </select>
                        <select name="area">
                            <option value="0" disabled selected>Округ</option>
                            <option value="ЦАО"  {{ app.request.query.all.area=='ЦАО' ? 'selected="selected"' : '' }}>ЦАО</option>
                            <option value="СВАО" {{ app.request.query.all.area=='СВАО' ? 'selected="selected"' : '' }}>СВАО</option>
                            <option value="ВАО"  {{ app.request.query.all.area=='ВАО' ? 'selected="selected"' : '' }}>ВАО</option>
                            <option value="ЮВАО" {{ app.request.query.all.area=='ЮВАО' ? 'selected="selected"' : '' }}>ЮВАО</option>
                            <option value="ЮАО"  {{ app.request.query.all.area=='ЮАО' ? 'selected="selected"' : '' }}>ЮАО</option>
                            <option value="ЮЗАО" {{ app.request.query.all.area=='ЮЗАО' ? 'selected="selected"' : '' }}>ЮЗАО</option>
                            <option value="ЗАО"  {{ app.request.query.all.area=='ЗАО' ? 'selected="selected"' : '' }}>ЗАО</option>
                            <option value="CЗАО" {{ app.request.query.all.area=='CЗАО' ? 'selected="selected"' : '' }}>CЗАО</option>
                            <option value="CАО"  {{ app.request.query.all.area=='CАО' ? 'selected="selected"' : '' }}>CАО</option>
                        </select>
                        <input type="text" placeholder="Улица" id="street" name="street" value="{{ app.request.query.all.street is defined ? app.request.query.all.street : '' }}" >
                        <div class="check-group">
                            Пакеты
                            <div class="check"></div>
                            <input type="hidden" name="packet" value="0">
                        </div>
                        <select name="type">
                            <option value="0" disabled selected>Типы конструкций</option>
                            <option value="1">Щиты</option>
                        </select>
                        <br />
                        <br />
                        <div style="text-align: right">
                        <span class="btn2" id="form-submit">
                            Найти
                        </span>
                        </div>
                        <br />
                        <br />
                    </div>
                </form>
            </div>
        </div>
        <div class="col-sm-8">
            {% for b in banners %}
                <div class="hot-box">
                    <div class="hot-img">
                        <a href="{{ b.img }}" class="fancybox"><img class="img" src="{{ b.img }}"></a>
                        <img class="hot-icon" src="{{ asset('bundles/app/images/hot.png') }}">
                    </div>
                    <br />
                    <table class="hot-params">
                        <tr>
                            <td>Адрес</td>
                            <td>{{ b.adrs }}</td>
                        </tr>
                        <tr>
                            <td>Формат</td>
                            <td>{{ b.format }}</td>
                        </tr>
                        <tr>
                            <td>Цена</td>
                            <td><b class="pink">{{ b.price }} р.</b></td>
                        </tr>
                        <tr>
                            <td>Период</td>
                            <td><b class="pink">Апрель</b></td>
                        </tr>
                    </table>
                    <div>
                        <br />
                        <table style="width: 100%">
                            <tr>
                                <td style="width: 50%">
                                    <a href="{{ path('map',{'bannerId' : b.id}) }}">
                                        <span class="btn2">На карте</span>
                                    </a>
                                </td>
                                <td style="text-align: right">
                                    <span class="btn-pink addbasket" data-id="{{ b.id }}" data-month="4">Заказать</span>
                                </td>
                            </tr>
                        </table>
                        <br />
                    </div>
                </div>
            {% else %}
                <h2 class="pink" style="text-align: center; display: block">По данному запросу предложений не найдено</h2>
            {% endfor %}
        </div>
    </div>
    <br />
    <br />
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(document).ready(function(){
            $('#form-submit').click(function(){
                $('#form').submit();
            });

            function orderRefresh(){
                $.ajax({
                    url: Routing.generate('order_price'),
                    method: 'GET',
                    success: function(msg){
                        $('#order-btn').html('Заказ на сумму '+msg+' р.');
                        $('#order-btn').css('display','block');
                    }
                });
            }

            $('.addBasket').click(function(){
                $.ajax({
                    url: Routing.generate('basket_add', {'itemId': $(this).attr('data-id'), 'month': $(this).attr('data-month')}),
                    method: 'POST',
                    success: function(msg){
                        $.notify("позиция добавлена в медиаплан", "success");
                        orderRefresh();
                    }
                });
            });
        });
    </script>
{% endblock %}