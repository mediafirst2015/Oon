{% extends 'AppBundle::layout.html.twig' %}

{% block content %}
    <div class="row">
        <div class="col-lg-12" style="  margin-top: -20px;">
            <div style="float: left">
                <h2 class="green">Поиск щитов по карте</h2>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-3">
            <div class="box">
                <form method="GET" id="form" action="{{ path('map') }}">
                    <div class="form">
                        <h2 class="green">Фильтры</h2>
                        <div style="display:inline-block; position:relative;">
                            <select name="city" id="city2" style="width: 221px;margin-left: 10px;">
                                <option value="" disabled selected>Город</option>
                                {% for c in cities %}
                                    <option value="{{ c.title }}" {{ params.city == c.title  ? 'selected="selected"' }}>{{ c.title }}</option>
                                {% endfor %}
                            </select>
                            <div style="position:absolute; left:0; right:0; top:0; bottom:0;" class="clear"></div>
                        </div>​


                        <select name="area" id="area2" {{ params.city != 'Москва' ? 'disabled="disabled" style="color:#CCC;"' : '' }}>
                            <option value="" disabled selected>Округ</option>
                            <option value="" selected>Все округа</option>
                            <option value="ЦАО" {{ params.area == 'ЦАО' ? 'selected="selected"' }}>ЦАО</option>
                            <option value="СВАО" {{ params.area == 'СВАО' ? 'selected="selected"' }}>СВАО</option>
                            <option value="ВАО" {{ params.area == 'ВАО' ? 'selected="selected"' }}>ВАО</option>
                            <option value="ЮВАО" {{ params.area == 'ЮВАО' ? 'selected="selected"' }}>ЮВАО</option>
                            <option value="ЮАО" {{ params.area == 'ЮАО' ? 'selected="selected"' }}>ЮАО</option>
                            <option value="ЮЗАО" {{ params.area == 'ЮЗАО' ? 'selected="selected"' }}>ЮЗАО</option>
                            <option value="ЗАО" {{ params.area == 'ЗАО' ? 'selected="selected"' }}>ЗАО</option>
                            <option value="CЗАО" {{ params.area == 'CЗАО' ? 'selected="selected"' }}>CЗАО</option>
                            <option value="САО" {{ params.area == 'САО' ? 'selected="selected"' }}>САО</option>
                        </select>
                        <input type="text" placeholder="Улица" id="street" name="street" value="{{ params.street }}">
                        <br />
                        <div class="input-group" style="padding-left: 10px">
                            Период
                            <div style="float: right;">
                                с&nbsp;&nbsp;
                                <select class="mini" name="dateStart">
                                    <option value="0" selected="selected">Нач</option>
                                    <option value="1"  {{ params.dateStart == '1' ? 'selected="selected"' :  'now'|date('m')+1 == 1 ? 'selected="selected"' : '' }}>Янв</option>
                                    <option value="2"  {{ params.dateStart == '2' ? 'selected="selected"' :  'now'|date('m')+1 == 2 ? 'selected="selected"' : '' }}>Фев</option>
                                    <option value="3"  {{ params.dateStart == '3' ? 'selected="selected"' :  'now'|date('m')+1 == 3 ? 'selected="selected"' : '' }}>Мар</option>
                                    <option value="4"  {{ params.dateStart == '4' ? 'selected="selected"' :  'now'|date('m')+1 == 4 ? 'selected="selected"' : '' }}>Апр</option>
                                    <option value="5"  {{ params.dateStart == '5' ? 'selected="selected"' :  'now'|date('m')+1 == 5 ? 'selected="selected"' : '' }}>Май</option>
                                    <option value="6"  {{ params.dateStart == '6' ? 'selected="selected"' :  'now'|date('m')+1 == 6 ? 'selected="selected"' : '' }}>Июн</option>
                                    <option value="7"  {{ params.dateStart == '7' ? 'selected="selected"' :  'now'|date('m')+1 == 7 ? 'selected="selected"' : '' }}>Июл</option>
                                    <option value="8"  {{ params.dateStart == '8' ? 'selected="selected"' :  'now'|date('m')+1 == 8 ? 'selected="selected"' : '' }}>Авг</option>
                                    <option value="9"  {{ params.dateStart == '9' ? 'selected="selected"' :  'now'|date('m')+1 == 9 ? 'selected="selected"' : '' }}>Сен</option>
                                    <option value="10" {{ params.dateStart == '10' ? 'selected="selected"' : 'now'|date('m')+1 == 10 ? 'selected="selected"' : '' }}>Окт</option>
                                    <option value="11" {{ params.dateStart == '11' ? 'selected="selected"' : 'now'|date('m')+1 == 11 ? 'selected="selected"' : '' }}>Ноя</option>
                                    <option value="12" {{ params.dateStart == '12' ? 'selected="selected"' : 'now'|date('m')+1 == 12 ? 'selected="selected"' : '' }}>Дек</option>
                                </select>
                                &nbsp;&nbsp;по&nbsp;&nbsp;
                                <select class="mini" name="dateEnd">
                                    <option value="0" selected="selected">Кон</option>
                                    <option value="1"  {{ params.dateEnd == '1' ? 'selected="selected"' :  'now'|date('m')+1 == 1 ? 'selected="selected"' : ''  }}>Янв</option>
                                    <option value="2"  {{ params.dateEnd == '2' ? 'selected="selected"' :  'now'|date('m')+1 == 2 ? 'selected="selected"' : ''  }}>Фев</option>
                                    <option value="3"  {{ params.dateEnd == '3' ? 'selected="selected"' :  'now'|date('m')+1 == 3 ? 'selected="selected"' : ''  }}>Мар</option>
                                    <option value="4"  {{ params.dateEnd == '4' ? 'selected="selected"' :  'now'|date('m')+1 == 4 ? 'selected="selected"' : ''  }}>Апр</option>
                                    <option value="5"  {{ params.dateEnd == '5' ? 'selected="selected"' :  'now'|date('m')+1 == 5 ? 'selected="selected"' : ''  }}>Май</option>
                                    <option value="6"  {{ params.dateEnd == '6' ? 'selected="selected"' :  'now'|date('m')+1 == 6 ? 'selected="selected"' : ''  }}>Июн</option>
                                    <option value="7"  {{ params.dateEnd == '7' ? 'selected="selected"' :  'now'|date('m')+1 == 7 ? 'selected="selected"' : ''  }}>Июл</option>
                                    <option value="8"  {{ params.dateEnd == '8' ? 'selected="selected"' :  'now'|date('m')+1 == 8 ? 'selected="selected"' : ''  }}>Авг</option>
                                    <option value="9"  {{ params.dateEnd == '9' ? 'selected="selected"' :  'now'|date('m')+1 == 9 ? 'selected="selected"' : ''  }}>Сен</option>
                                    <option value="10" {{ params.dateEnd == '10' ? 'selected="selected"' : 'now'|date('m')+1 == 10 ? 'selected="selected"' : '' }}>Окт</option>
                                    <option value="11" {{ params.dateEnd == '11' ? 'selected="selected"' : 'now'|date('m')+1 == 11 ? 'selected="selected"' : '' }}>Ноя</option>
                                    <option value="12" {{ params.dateEnd == '12' ? 'selected="selected"' : 'now'|date('m')+1 == 12 ? 'selected="selected"' : '' }}>Дек</option>
                                </select>
                            </div>
                        </div>
                        <br />
                        {% if 'now'|date('d') >= 25 %}
                            <div class="check-group">
                                Только горящие
                                <div class="check {{ params.hot == 1 ? 'active' : '' }}"></div>
                                <input type="hidden" name="hot" value="{{ params.hot == 1 ? 1 : 0 }}">
                            </div>
                            <br />
                        {% endif %}
                        <div class="check-group">
                            Формат 3х6
                            <div class="check {{ params.formatM == 1 ? 'active' : '' }}"></div>
                            <input type="hidden" name="formatM" value="{{ params.formatM == 1 ? 1 : 0 }}">
                        </div>
                        <div class="check-group">
                            Малые форматы
                            <div class="check {{ params.formatS == 1 ? 'active' : '' }}"></div>
                            <input type="hidden" name="formatS" value="{{ params.formatS == 1 ? 1 : 0 }}">
                        </div>
                        <div class="check-group">
                            Большие форматы
                            <div class="check {{ params.formatL == 1 ? 'active' : '' }}"></div>
                            <input type="hidden" name="formatL" value="{{ params.formatL == 1 ? 1 : 0 }}">
                        </div>
                        <div class="check-group">
                            Ситиборды
                            <div class="check {{ params.formatSB == 1 ? 'active' : '' }}"></div>
                            <input type="hidden" name="formatSB" value="{{ params.formatSB == 1 ? 1 : 0 }}">
                        </div>
                        <br />
                        <div class="check-group">
                            Только с подстветкой
                            <div class="check {{ params.light == 1 ? 'active' : '' }}"></div>
                            <input type="hidden" name="light" value="{{ params.light == 1 ? 1 : 0 }}">
                        </div>
                        <br />
                        <div class="slider-group">
                            <span class="caption">GRP</span>
                            <span id="grp-amount" class="val contentEditable" contentEditable="true"></span>
                            <span class="slider" id="grp"></span>
                            <input type="hidden" name="grp-min" id="grp-min" value="{{ params.grpMin != null ? params.grpMin : 0 }}">
                            <input type="hidden" name="grp-max" id="grp-max" value="{{ params.grpMax != null ? params.grpMax : 15 }}">
                        </div>
                        <div class="slider-group">
                            <span class="caption">OTS</span>
                            <span id="ots-amount" class="val contentEditable" contentEditable="true"></span>
                            <span class="slider"  id="ots"></span>
                            <input type="hidden" name="ots-min" id="ots-min" value="{{ params.otsMin != null ? params.otsMin : 0 }}">
                            <input type="hidden" name="ots-max" id="ots-max" value="{{ params.otsMax != null ? params.otsMax : 500 }}">
                        </div>
                        <div class="slider-group">
                            <span class="caption">Стоимость (тыс.р.)</span>
                            <span id="price-amount" class="val contentEditable" contentEditable="true"></span>
                            <span class="slider" id="price"></span>
                            <input type="hidden" name="price-min" id="price-min" value="{{ params.priceMin != null ? params.priceMin : 0 }}">
                            <input type="hidden" name="price-max" id="price-max" value="{{ params.priceMax != null ? params.priceMax : 999 }}">
                        </div>
                        <br/>
                        <br/>
                        <div style="text-align: right">
                        <span class="btn" id="form-submit">
                            Найти
                        </span>
                        </div>
                        <br/>
                    </div>
                </form>
            </div>
        </div>
        <div class="col-lg-9">
            <img src="{{ asset('bundles/app/images/tooltip.png') }}" style="z-index: 1000;display: block;position: absolute;left: 50%;top: 12px;margin-left: -377px;"/>
            <div id="submap" style="margin-top: 13px; position: relative">
                <div id="gray"></div>
                <div id="dinamys-popups" style="display: none"></div>
                <img src="{{ asset('bundles/app/images/loader.gif') }}" id="loader-map">
                <div id="map"></div>
                <div class="icheck">
                    Показать <b>Все</b>
                    {% if app.request.query.all.my is defined and app.request.query.all.my == 1 %}
    <a href="?my=0"><img src="{{ asset('bundles/app/images/icheck-act.png') }}" style="margin-top: -5px;"></a>
{% else %}
    <a href="?my=1"><img src="{{ asset('bundles/app/images/icheck.png') }}" style="margin-top: -5px;"></a>
{% endif %}
                    <b>Выбранные</b>
                </div>
            </div>
            <br />
            <br />
        </div>
    </div>
    <div class="row" id="basket">
        <div class="col-sm-12">
            <div id="basket-table">
                {{ include('AppBundle:Basket:table.html.twig') }}
            </div>
            <br />
            <br />
        </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/app/pieChartClusterer/pie-chart-clusterer.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('bundles/app/kladrapi/jquery.kladr.min.js') }}" type="text/javascript"></script>
    <script type="text/javascript">

        $(document).ready(function(){

            $('#form-submit').click(function(){
                $('#form').submit();
            });

            $('#popover').popover({
                placement: 'left',
                title: 'Подсказка',
                content: 'Чтобы посмотреть сразу несколько поверхностей выделите их на карте. Для этого первым кликом на карте установите левый верхний угол, в вторым кликом - правый нижний угол выделяемой области.'
            });

            var map;
            var objects;
            var clusterer = null;
            ymaps.ready(init);
            function init() {
                map = new ymaps.Map('map', {
                    {% if thisBanner != null %}
                        center: [{{ thisBanner.latitude }}, {{ thisBanner.longitude }}],
                        zoom: 15,
                    {% elseif pos.x != null and pos.y != null %}
                        center: [{{ pos.x }}, {{ pos.y }}],
                    {% if (street) %}
                        zoom: 15,
                    {% else %}
                        zoom: 12,
                    {% endif %}
                    {% else %}
                        center: [55.755381, 37.619044],
                        zoom: 11,
                    {% endif %}
                    controls: ['zoomControl']
                });





                ymaps.modules.require(['PieChartClusterer'], function (PieChartClusterer) {

                    clusterer = new PieChartClusterer(
                            {
//                                clusterDisableClickZoom: true,
//                                clusterOpenBalloonOnClick: true,
                                // Устанавливаем стандартный макет балуна кластера "Аккордеон".
                                clusterBalloonContentLayout: 'cluster#balloonAccordion',
                                // Устанавливаем собственный макет.
                                clusterBalloonItemContentLayout: customItemContentLayout,
                                // Устанавливаем режим открытия балуна.
                                // В данном примере балун никогда не будет открываться в режиме панели.
                                clusterBalloonPanelMaxMapArea: 0,
                                // Устанавливаем размеры макета контента балуна (в пикселях).
                                clusterBalloonContentLayoutWidth: 300,
                                clusterBalloonContentLayoutHeight: 450
                                // Можно отключить отображение иконок геообъектов в списке.
                                // В браузере Internet Explorer ниже 9й версии иконки никогда не будут отображаться.
                                // clusterBalloonAccordionShowIcons: false
                            }
                    );
                    var filter =
                            'id={{ id }}'+
                            '&city={{ params.city }}'+
                            '&street={{ params.street }}'+
                            '&area={{ params.area }}'+
                            '&formatS={{ params.formatS }}'+
                            '&formatM={{ params.formatM }}'+
                            '&formatL={{ params.formatL }}'+
                            '&formatSB={{ params.formatSB }}'+
                            '&type='+
                            '&light={{ params.light }}'+
                            '&grpMin={{ params.grpMin }}'+
                            '&grpMax={{ params.grpMax }}'+
                            '&otsMin={{ params.otsMin }}'+
                            '&otsMax={{ params.otsMax }}'+
                            '&priceMin={{ params.priceMin }}'+
                            '&priceMax={{ params.priceMax }}'+
                            '&hot={{ params.hot }}';

                    objects = getObjects(filter);
//                    console.log(objects);
//                    clusterer.add(objects);
//                    myMap.geoObjects.add(clusterer);

                });



                map.events.add('click', function (e) {
                    var target = e.get('target')
                    target.balloon.close();
                });

                var customItemContentLayout = ymaps.templateLayoutFactory.createClass(
                    // Флаг "raw" означает, что данные вставляют "как есть" без экранирования html.  <h2 class=ballon_header>{{ '{{' }} properties.balloonContentHeader|raw {{ '}}' }}</h2>
                        '' +
                        '<div class=ballon_body>{{ '{{' }} properties.balloonContentBody|raw {{ '}}' }}</div>' +
                        '<div class=ballon_footer>{{ '{{' }} properties.balloonContentFooter|raw {{ '}}' }}</div>'
                );
            }




                function orderRefresh(){
                    $.ajax({
                        url: Routing.generate('order_price'),
                        method: 'GET',
                        success: function(msg){
                            $('#order-btn').html('Выбрано на сумму '+msg+' р.');
                            $('#order-btn').css('display','block');
                            if (msg != 0 || msg != '0' || msg != '0.0'){
                                $('.clear').css('display','block');
                            }else{
                                $('.clear').css('display','none');
                            }
                        }
                    });
                }

                function getObjects(filter){
                    {% if app.request.query.all.my is defined and app.request.query.all.my == 1 %}
                    var url = '{{ path('get_my_objects') }}';
                    {% else %}
                    var url = '{{ path('get_objects') }}';
                    {% endif %}
                    $.ajax({
                        url: url,
                        processData: false,
                        method: 'POST',
                        data: filter,
                        success: function(msg){
                            objects = msg.data;
                            var placemarks = [];
                            var j = 0;

                            if ( objects != null && objects.length != 0 ) {
                                for (var i in objects) {
                                    {% if thisBanner != null %}
                                    var img = '/bundles/app/images/arrow-down.png';
                                    {% else %}
//                                    if (objects[i].hot != '0' && objects[i].hot != 0 && objects[i].hot != null) {
//                                        var img = '/bundles/app/images/fire.gif';
//                                    } else {
//                                        if (objects[i].format == '3x6') {
//                                            var img = '/bundles/app/images/mapIcon3.png';
//                                        } else {
//                                            if (objects[i].format == 'big') {
//                                                var img = '/bundles/app/images/mapIcon4.png';
//                                            } else {
//                                                if (objects[i].format == 'small') {
//                                                    var img = '/bundles/app/images/mapIcon5.png';
//                                                } else {
//                                                    var img = '/bundles/app/images/mapIcon1.png';
//                                                }
//                                            }
//                                        }
//                                    }
                                    if (objects[i].hot != '0' && objects[i].hot != 0 && objects[i].hot != null) {
                                        var img = 'islands#darkOrangeDotIcon';
                                    } else {
                                        if (objects[i].type == 'PROMO'){
                                            var img = 'islands#darkOrangeCircleDotIcon';
                                        }else{
                                            if (objects[i].format == '3x6') {
                                                var img = 'islands#blueDotIcon';
                                            } else {
                                                if (objects[i].format == 'big') {
                                                    var img = 'islands#darkGreenDotIcon';
                                                } else {
                                                    if (objects[i].format == 'small') {
                                                        var img = 'islands#brownDotIcon';
                                                    } else {
                                                        var img = 'islands#violetDotIcon';
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    {% endif %}
                                    placemarks[j] = new ymaps.GeoObject({
//                                                id: objects[i].id,
                                                geometry: {
                                                    type: "Point",
                                                    coordinates: objects[i].coords //Массив
                                                },
                                                properties: {
                                                    hintContent: objects[i].alt, //Подсказка
//                                    balloonContent: objects[i].content
                                                    balloonContent: '',
                                                    itemId: objects[i].id

                                                }
                                            }, {
                                                balloonPanelMaxMapArea: 0,
                                                openEmptyBalloon: true,
//                                            iconLayout: 'default#image',
//                                            iconImageHref: img,
                                                preset: img,
                                                {#{% if thisBanner != null %}#}
//                                                iconImageSize: [32, 32],
                                                {#{% else %}#}
//                                                iconImageSize: [16, 16],
                                                {#{% endif %}#}
                                            }
                                    );

                                    j++;
                                }
//                                return placemarks;
                                {#var clusterer = new ymaps.Cl({#}
{#//#}
                                    {#preset: 'islands#darkGreenClusterIcons',#}
                                    {#clusterOpenBalloonOnClick: true,#}
                                    {#clusterBalloonCycling: false,#}
{#//                                groupByCoordinates: true,#}
                                    {#{% if app.request.query.all.my is defined and app.request.query.all.my == 1 %}#}
{#//                                    maxZoom: 0,#}
                                    {#&#123;&#35;{% else %}&#35;&#125;#}
                                    {#maxZoom: 12, //24#}
                                    {#&#123;&#35;{% endif %}&#35;&#125;#}
                                {#});#}




                                clusterer.events.add('balloonopen',function(e){
                                    var target = e.get('target');
                                    if (typeof target.getData != 'undefined') {//
                                        var objs = target.getData().cluster.properties.getAll().geoObjects;
                                        var str = '';
                                        for ( i = 0 ; i < objs.length ; i ++ ){
                                            str += objs[i].properties.get('itemId')+'|';
                                        }
                                        $.ajax({
                                            url: Routing.generate('get_more_info'),
                                            data: 'items='+str,
                                            method: 'POST',
                                            success: function(msg){
                                                for ( i = 0 ; i < msg.data.length ; i++ ){
                                                    objs[i].properties.set('name', msg.data[i].title);
                                                    objs[i].properties.set('clusterCaption', msg.data[i].title);
                                                    objs[i].properties.set('balloonContentBody', msg.data[i].body);
                                                }
                                            },
                                            error: function(){
                                                target.properties.set('balloonContent', 'Не удалось загрузить контент');
                                                console.log('ajax error');
                                            }
                                        });
                                    }else{
                                        $.ajax({
                                            url: Routing.generate('get_more_info'),
                                            data: 'itemId='+ target.properties.get('itemId'),
                                            method: 'POST',
                                            success: function(msg){
                                                target.properties.set('balloonContent', msg);
                                            },
                                            error: function(){
                                                target.properties.set('balloonContent', 'Не удалось загрузить контент');
                                            }
                                        });
                                    }
                                });
                                clusterer.add(placemarks);
                                map.geoObjects.add(clusterer);



                                $('#loader-map').css('display','none');
                                $('#gray').css('display','none');

                            }else{
                                $('#gray').css('display','block');
                                $('#loader-map').css('display','none');
                                $('#dinamys-popups').css('display','block');
                                $('#dinamys-popups').html('<div class="flashbag-success-2"><span>Не найдено предложений,<br />удовлетворяющих Вашему запросу</span></div>');

                            }
                        }
                    });
                }


                $('#excel').click(function () {
                    var area = $('#area').val();
                    var format = $('#format').val();
                    var type = $('#type').val();
                    var light = $('#light').val();
                    var grpMin = $("#grp").slider("values", 0) / 100;
                    var grpMax = $("#grp").slider("values", 1) / 100;
                    var otsMin = $("#ots").slider("values", 0);
                    var otsMax = $("#ots").slider("values", 1);

                    var filter =
                            'street='+street+
                            'area='+area+
                            '&format='+format+
                            '&type='+type+
                            '&light='+light+
                            '&grpMin='+grpMin+
                            '&grpMax='+grpMax+
                            '&otsMin='+otsMin+
                            '&otsMax='+otsMax;
                    var url = '{{ path('all_export') }}?'+filter;
                    window.location.href = url;
                });

                $('#street' ).kladr({
                    token: '541ee4ac7c52392c7d8b457e',
                    key: '181d5e2c44994c335e5e81e9ae46e79a67b6b495',
                    type: $.kladr.type.street,
                    parentType: $.kladr.type.city,
                    parentId: '7700000000000',
                    select: function(obj){
                        $('#street').val(obj.name);
                    }
                });

                $('#map').on('click','input.addBasket', function(){
                    var item = $(this);
                    $.ajax({
                        url: Routing.generate('basket_add', {'itemId': $(this).attr('data-id'), 'month': $(this).attr('data-month')}),
                        method: 'POST',
                        success: function(msg){
                            $('#basket-table').html(msg);
                            if ( item.prop('checked') == true ){
                                item.attr('checked','checked');
                                $('.thrumb').notify("позиция добавлена в медиаплан",{ className: 'success', autoHideDelay: 1200, position: "bottom",  showDuration: 0,  hideDuration: 0  });
                            }else{
                                item.removeAttr('checked');
                                $('.thrumb').notify("позиция удалена из медиаплана",{ className: 'success', autoHideDelay: 1200, position: "bottom",  showDuration: 0,  hideDuration: 0  });
                            }
                            orderRefresh();
                        }
                    });
                });

                $('#basket-table').on('click','.removeBasket', function(){
                    var item = $(this)
                    $.ajax({
                        url: Routing.generate('basket_remove', {'itemId': $(this).attr('data-id') }),
                        method: 'POST',
                        success: function(msg){
                            var item2 = item.parent().parent().next();
                            item2 = item2.attr('class');
                            $('#basket-table').html(msg);
                            console.log(item2);
                            item2 = $('.'+item2);
                            console.log(item2);
                            item2.notify("позиция удалена",{ className: 'success', autoHideDelay: 1200, position: "bottom right",  showDuration: 0,  hideDuration: 0  });
                            orderRefresh();
                        }
                    });
                });


                $( "#grp" ).slider({
                    range: true,
                    min: 0,
                    max: 1500,
                    values: [ {{ params.grpMin != null ? params.grpMin*100 : 0 }}, {{ params.grpMax != null ? params.grpMax*100 : 1500 }} ],
                    slide: function( event, ui ) {
                        $( "#grp-amount" ).html( "" + ui.values[ 0 ]/100 + " - " + ui.values[ 1 ]/100 );
                        $( "#grp-min" ).val(ui.values[ 0 ]/100);
                        $( "#grp-max" ).val(ui.values[ 1 ]/100);
                    }
                });
                $( "#grp-amount" ).html( "" + $( "#grp" ).slider( "values", 0 )/100 +
                " - " + $( "#grp" ).slider( "values", 1 )/100 );

                $( "#ots" ).slider({
                    range: true,
                    min: 0,
                    max: 500,
                    values: [ {{ params.otsMin != null ? params.otsMin : 0 }}, {{ params.otsMax != null ? params.otsMax : 500 }} ],
                    slide: function( event, ui ) {
                        $( "#ots-amount" ).html( "" + ui.values[ 0 ] + " - " + ui.values[ 1 ] );
                        $( "#ots-min" ).val(ui.values[ 0 ]);
                        $( "#ots-max" ).val(ui.values[ 1 ]);
                    }
                });
                $( "#ots-amount" ).html( "" + $( "#ots" ).slider( "values", 0 ) +
                " - " + $( "#ots" ).slider( "values", 1 ) );

                $( "#price" ).slider({
                    range: true,
                    min: 0,
                    max: 999,
                    values: [ {{ params.priceMin != null ? params.priceMin : 0 }}, {{ params.priceMax != null ? params.priceMax : 999 }} ],
                    slide: function( event, ui ) {
                        $( "#price-amount" ).html( "" + ui.values[ 0 ] + " - " + ui.values[ 1 ]);
                        $( "#price-min" ).val(ui.values[ 0 ]);
                        $( "#price-max" ).val(ui.values[ 1 ]);
                    }
                });
                $( "#price-amount" ).html( "" + $( "#price" ).slider( "values", 0 ) +
                " - " + $( "#price" ).slider( "values", 1 ) );

                $('#city2').change(function(){
                    if ($(this).val() != 'Москва'){
                        $('#area2').prop( "disabled", true  );
                        $('#area2 option').eq(0).prop('selected', true);
                    }else{
                        $('#area2').prop( "disabled", false);
                    }
                });

                {% if price != 0 and price != '0' and price != '0.0'%}
                    $('.clear').css('display','block');
                {% endif %}

                $('.clear').click(function(event){
                    $('.clear').popover({
                        placement: 'bottom',
                        title: 'ПРЕДУПРЕЖДЕНИЕ',
                        content: 'Что бы перейти в другой город удалите все выбраные поверхности из медиаплана',
                        width: '200'
                    });
                });

            });
    </script>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('bundles/app/kladrapi/jquery.kladr.css') }}" rel="stylesheet" media="all">
    <style>
        .container{
            min-width: 800px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .thrumb{
            margin: 0 auto;
            display: inline-block;
            width: 250px;
            border-radius: 10px;
        }
        .map-setting tr td:first-child{
            width: 150px;
            padding-left: 20px;
        }
        .map-title{
            font-size: 16px;
            padding: 5px;
            padding-bottom: 15px;
            padding-top: 15px;
        }
        .map-month{
            transform: rotate(270deg);
            /*transform-origin: left top 0;*/
            padding-bottom: 5px;
        }
        #submap{
            display: inline-block;
            box-shadow: 0 1px 16px 0 rgba(1, 1, 1, 0.51);
            width: 100%;
        }
        #map{
            -moz-border-radius: 14px 14px 14px 14px; /* Firefox */
            -webkit-border-radius: 14px 14px 14px 14px; /* Safari, Chrome */
            -khtml-border-radius: 14px 14px 14px 14px; /* KHTML */
            border-radius: 14px 14px 14px 14px; /* CSS3 */
            overflow: hidden;
            position: relative;
            -webkit-mask-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAA5JREFUeNpiYGBgAAgwAAAEAAGbA+oJAAAAAElFTkSuQmCC);
            width: 100%;
            height: 760px;
        }
        /*transform: rotate(-40deg);*/
        .notifyjs-wrapper{
            z-index: 1001;
        }
        .popover{
            width: 280px;
        }
        .clear{
            display: none;
        }
    </style>
{% endblock %}