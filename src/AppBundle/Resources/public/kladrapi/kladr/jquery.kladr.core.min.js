!function(e){function t(e){var t={},r={token:"token",key:"key",type:"contentType",name:"query",withParents:"withParent",oneString:"oneString",limit:"limit"};e.parentType&&e.parentId&&(t[e.parentType+"Id"]=e.parentId);for(var n in e)e.hasOwnProperty(n)&&r.hasOwnProperty(n)&&e[n]&&(t[r[n]]=e[n]);return t}function r(e){window.console&&window.console.error&&window.console.error(e)}e.kladr={},e.kladr.url="http://kladr-api.ru/api.php",e.kladr.type={region:"region",district:"district",city:"city",street:"street",building:"building"},e.kladr.validate=function(t){switch(t.type){case e.kladr.type.region:case e.kladr.type.district:case e.kladr.type.city:if(t.parentType&&!t.parentId)return r("parentId undefined"),!1;break;case e.kladr.type.street:if(t.parentType!=e.kladr.type.city)return r('parentType must equal "city"'),!1;if(!t.parentId)return r("parentId undefined"),!1;break;case e.kladr.type.building:if(t.parentType!=e.kladr.type.street)return r('parentType must equal "street"'),!1;if(!t.parentId)return r("parentId undefined"),!1;break;default:if(!t.oneString)return r("type incorrect"),!1}return t.oneString&&t.parentType&&!t.parentId?(r("parentId undefined"),!1):t.limit<1?(r("limit must greater than 0"),!1):!0},e.kladr.api=function(n,i){if(!i)return void r("Callback undefined");if(!e.kladr.validate(n))return void i([]);var a=e.Deferred();a.done(i),a.fail(function(e){r(e),i([])}),e.getJSON(e.kladr.url+"?callback=?",t(n),function(e){a.resolve(e.result||[])}),setTimeout(function(){a.reject("Request error")},3e3)},e.kladr.check=function(t,n){return n?(t.withParents=!1,t.limit=1,void e.kladr.api(t,function(e){n(e&&e.length?e[0]:!1)})):void r("Callback undefined")}}(jQuery);